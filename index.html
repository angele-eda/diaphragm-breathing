<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>횡격막 호흡 APP</title>

  <link rel="manifest" href="manifest.json">

  <style>
    body {
      margin: 0;
      padding: 0;
      text-align: center;
      background: #eef2f9;
      font-family: "Pretendard", sans-serif;
    }

    header img {
      width: 100%;
      border-bottom-left-radius: 18px;
      border-bottom-right-radius: 18px;
    }

    h2 {
      margin-top: 18px;
      font-size: 22px;
      font-weight: 700;
    }

    .btnWrap {
      margin-top: 14px;
      display: flex;
      justify-content: center;
      flex-wrap: wrap;
      gap: 10px;
    }

    button {
      padding: 12px 20px;
      border: none;
      border-radius: 10px;
      background: #4B82FF;
      color: white;
      font-size: 16px;
    }

    #modeImage {
      width: 85%;
      margin-top: 20px;
      border-radius: 12px;
    }

    #timer {
      font-size: 28px;
      margin-top: 15px;
      font-weight: 700;
      color: #333;
    }

    #banner {
      margin-top: 22px;
      width: 100%;
    }
  </style>
</head>

<body>

  <!-- Hero 이미지 -->
  <header>
    <img src="img/hero_main.png" />
  </header>

  <h2>호흡법 선택</h2>

  <div class="btnWrap">
    <button onclick="selectMode('426')">4-2-6 호흡</button>
    <button onclick="selectMode('478')">4-7-8 수면 호흡</button>
    <button onclick="selectMode('box')">4-4-4-4 박스 호흡</button>
  </div>

  <!-- 선택된 호흡 이미지 -->
  <img id="modeImage" src="img/426.png">

  <!-- 타이머 표시 -->
  <div id="timer">준비</div>

  <!-- 배너 -->
  <img id="banner" src="img/banner_sleep.png">

  <script>
    let inhaleSound = new Audio("sound/soft_sleep_chime.wav");
    let exhaleSound = new Audio("sound/soft_click_0.2s.wav");

    let timerEl = document.getElementById("timer");
    let modeImage = document.getElementById("modeImage");

    let breathingPattern = [];
    let index = 0;
    let running = false;

    function selectMode(mode) {
      running = false;
      index = 0;

      if (mode === "426") {
        modeImage.src = "img/426.png";
        breathingPattern = [
          { state: "들숨", sec: 4 },
          { state: "멈춤", sec: 2 },
          { state: "날숨", sec: 6 },
        ];
      }

      if (mode === "478") {
        modeImage.src = "img/478.png";
        breathingPattern = [
          { state: "들숨", sec: 4 },
          { state: "멈춤", sec: 7 },
          { state: "날숨", sec: 8 },
        ];
      }

      if (mode === "box") {
        modeImage.src = "img/box.png";
        breathingPattern = [
          { state: "들숨", sec: 4 },
          { state: "멈춤", sec: 4 },
          { state: "날숨", sec: 4 },
          { state: "멈춤", sec: 4 },
        ];
      }

      startBreathing();
    }

    function startBreathing() {
      running = true;
      index = 0;
      runStep();
    }

    function runStep() {
      if (!running) return;

      let step = breathingPattern[index];
      timerEl.textContent = `${step.state} (${step.sec}s)`;

      // 숨소리
      if (step.state === "들숨") inhaleSound.play();
      if (step.state === "날숨") exhaleSound.play();

      let sec = step.sec;

      let interval = setInterval(() => {
        if (!running) {
          clearInterval(interval);
          return;
        }

        sec--;
        timerEl.textContent = `${step.state} (${sec}s)`;

        if (sec <= 0) {
          clearInterval(interval);
          index = (index + 1) % breathingPattern.length;
          runStep();
        }

      }, 1000);
    }

    // serviceWorker 등록
    if ("serviceWorker" in navigator) {
      navigator.serviceWorker.register("sw.js");
    }
  </script>
</body>
</html>